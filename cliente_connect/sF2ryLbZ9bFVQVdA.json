{
  "createdAt": "2025-03-07T00:59:28.501Z",
  "updatedAt": "2025-03-10T01:28:03.872Z",
  "id": "sF2ryLbZ9bFVQVdA",
  "name": "#9| Agente de Atualiza√ß√£o - P√≥s Convers√£o - Naka",
  "active": true,
  "nodes": [
    {
      "parameters": {
        "queue": "agPosConversao",
        "options": {
          "arguments": {
            "argument": [
              {
                "key": "x-queue-type",
                "value": "quorum"
              }
            ]
          },
          "acknowledge": "executionFinishes",
          "jsonParseBody": true,
          "onlyContent": true
        }
      },
      "type": "n8n-nodes-base.rabbitmqTrigger",
      "typeVersion": 1,
      "position": [
        -880,
        -220
      ],
      "id": "c5892ab9-d8d6-4eef-976b-cb3b09b5b24b",
      "name": "RabbitMQ Trigger",
      "credentials": {
        "rabbitmq": {
          "id": "r7HKpgodPDe0c1iT",
          "name": "RabbitMQ - Connecta"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -580,
        -40
      ],
      "id": "ce029267-5980-4afa-96f9-f73d2d43d301",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "Ug76Jt0WOP7E4x1r",
          "name": "OpenAi - Connecta"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.session_id }}",
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -440,
        -40
      ],
      "id": "0e8411bc-3138-414d-8b49-51648b5744b9",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "8r0eU4HHjh6sf4sO",
          "name": "Postgres - Connecta"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "484e8db7-5134-4100-a559-edea35794f6a",
              "name": "iaMessage",
              "value": "={{ $json.output.split() }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        80,
        -220
      ],
      "id": "f9bd64d0-61ed-4049-902b-f44db885b40a",
      "name": "Set_Split"
    },
    {
      "parameters": {
        "fieldToSplitOut": "={{ $json.iaMessage[0] }}",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        280,
        -220
      ],
      "id": "6ab5a774-7ff5-41e2-94e4-3d609ed37e91",
      "name": "Split Out",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        480,
        -220
      ],
      "id": "36c593df-d653-4140-bb84-3ae0012d0939",
      "name": "Loop Over Items"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        700,
        -360
      ],
      "id": "30673b42-d490-4b44-9200-60d42a687c12",
      "name": "Finished"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://dinastia-evolution.lfigsi.easypanel.host/message/sendText/Deebs",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apiKey",
              "value": "46A8DD04E743-41B1-9AFD-78D9B9DB137B"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('RabbitMQ Trigger').item.json.session_id }}"
            },
            {
              "name": "text",
              "value": "={{ $('Set_Split').item.json.iaMessage[0] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "b4c4f3c8-2789-4c4c-84af-d20da975a9b4",
      "name": "respondeWhatsapp",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        700,
        -40
      ]
    },
    {
      "parameters": {
        "amount": 4
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        920,
        -40
      ],
      "id": "ffba6150-b723-4175-865c-2fe40c84d604",
      "name": "Wait",
      "webhookId": "06409997-570c-4e6d-ab27-3753d972064a"
    },
    {
      "parameters": {
        "name": "Check_Availability",
        "description": "Chame essa tool para buscar os dias e hor√°rios dispon√≠veis na agenda para retornar para o usu√°rios op√ß√µes dispon√≠veis de agendamento de consulta.\n\n**Envie o dia de interesse diretamente como o o usu√°rio requisitar, por exemplo:**\n\nter√ßa\ndia 23\namanh√£\nsemana que vem\n\n**Janelas de hor√°rio:**\n\nSe o usu√°rio informar de manh√£ envie 09h00 at√© 12h00.\nSe o usu√°rio informar de tarde envie 12h00 at√© 18h00.\nSe o usu√°rio informar um valor de hor√°rio, verifique se est√° entre manh√£ ou tarde e envie o respectivo valor.\n\n**Constraints:**\nEvite realizar adapta√ß√µes no dia que o usu√°rio solicitou, apenas envie diretamente o solicitado.",
        "workflowId": {
          "__rl": true,
          "value": "T6ledF0U3v58HChG",
          "mode": "list",
          "cachedResultName": "#6 Tool | Check Avaliability"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        -300,
        -40
      ],
      "id": "d9f09d84-459e-49e6-a824-453959dbeb2a",
      "name": "Check_Availability"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "DELETE FROM n8n_chat_histories;",
        "options": {}
      },
      "id": "486f9107-e2e7-4638-88f3-96dd297f3aed",
      "name": "Deletar_todas_as_mensagens",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -660,
        -440
      ],
      "credentials": {
        "postgres": {
          "id": "8r0eU4HHjh6sf4sO",
          "name": "Postgres - Connecta"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        280,
        160
      ],
      "id": "58ab6af1-c422-41e9-9dd5-8f7165de8306",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "Ug76Jt0WOP7E4x1r",
          "name": "OpenAi - Connecta"
        }
      }
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "documentsrag",
          "mode": "list",
          "cachedResultName": "documentsrag"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        -40,
        160
      ],
      "id": "a1c3cf3d-31bb-4584-8918-ccce835ae7f5",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "YDa81ISgD7aO0PpH",
          "name": "Supabase - Connecta"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -120,
        300
      ],
      "id": "369fc193-78aa-40d3-9686-30498cf41702",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "Ug76Jt0WOP7E4x1r",
          "name": "OpenAi - Connecta"
        }
      }
    },
    {
      "parameters": {
        "name": "vector_store",
        "description": "Chame esta tool quando o usu√°rio fizer alguma pergunta relacionada a tratamentos, t√©cnicas cir√∫rgicas, profissionais envolvidos, conv√™nios, valores, redes sociais da cl√≠nica, etc.",
        "topK": 10
      },
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        80,
        -40
      ],
      "id": "d58c9675-53eb-4c43-9184-8d781d5abd13",
      "name": "vector_store"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Nome do Lead:{{ $json.userName }}\nData Consulta:{{ $json.dataConsulta }}\nMensagem do Lead:{{ $('RabbitMQ Trigger').item.json.messages }}",
        "options": {
          "systemMessage": "=<Persona>\nSeu nome √© Let√≠cia, voc√™ √© uma profissional de Suporte e atendimento ultra qualificada na √°rea bari√°trica. Voc√™ √© simp√°tica, divertida e muito educada com os clientes. Al√©m disso, voc√™ √© extremamente persuasiva, emp√°tica, paciente e proativa. Seu tom de voz √© informal, por√©m profissional, adaptando-se ao estilo do cliente para criar uma conex√£o mais forte.\n</Persona>\n\n<Contexto>\nA data e hora atual √©: {{(() => {\n    // Define as op√ß√µes para formatar a data e hora no fuso hor√°rio correto\n    const options = {\n        timeZone: \"America/Sao_Paulo\",\n        hour12: false\n    };\n\n    // Obt√©m a data atual ajustada ao fuso hor√°rio de S√£o Paulo\n    const currentDate = new Date();\n\n    // Formata a data e hora no padr√£o ISO 8601 (sem erros de UTC)\n    const formattedDate = new Intl.DateTimeFormat(\"en-CA\", {\n        ...options,\n        dateStyle: \"short\",\n        timeStyle: \"medium\"\n    }).format(currentDate).replace(\", \", \"T\") + \"Z\";\n\n    // Obt√©m o nome do dia da semana no fuso hor√°rio correto\n    const diasDaSemana = [\n        \"domingo\", \"segunda-feira\", \"ter√ßa-feira\",\n        \"quarta-feira\", \"quinta-feira\", \"sexta-feira\", \"s√°bado\"\n    ];\n\n    // Ajusta o fuso hor√°rio e calcula o √≠ndice correto do dia da semana\n    const localDate = new Date(currentDate.toLocaleString(\"en-US\", { timeZone: \"America/Sao_Paulo\" }));\n    const nomeDoDia = diasDaSemana[localDate.getDay()];\n\n    // Retorna o resultado completo\n    return `${nomeDoDia.charAt(0).toUpperCase() + nomeDoDia.slice(1)}, ${formattedDate}`;\n})();}}.\nVoc√™ receber√° leads que agendaram uma consulta em nossa cl√≠nica atrav√©s do nosso WhatsApp. Esteja preparada para responder a uma variedade de perguntas sobre os tratamentos e para abordar quaisquer d√∫vidas ou preocupa√ß√µes que o lead possa ter, inclusive reagendamentos e cancelamentos.\nUm exemplo pr√°tico seria:\nOl√°, [nome do lead]! Aqui √© a Let√≠cia da Cl√≠nica Nakamura. üòä\nSeguindo o padr√£o brasileiro de data e hora (DD/MM/AAAA e HH), o assistente opera no fuso hor√°rio \"America/Sao_Paulo\".\n</Contexto>\n<Objetivo>\nSua miss√£o √© entender o que o usu√°rio est√° buscando no momento. Voc√™ deve tirar todas as d√∫vidas do usu√°rio e se certificar de que ele recebeu todas as informa√ß√µes necess√°rias para comparecer √† consulta.\nO usu√°rio pode:\n- Solicitar a altera√ß√£o da data ou hor√°rio de sua consulta (caso em que voc√™ deve utilizar a tool Update_Event).\n- Solicitar o cancelamento da consulta (caso em que voc√™ deve utilizar a tool Delete_Event).\n</Objetivo>\n\n<Observa√ß√µes Importantes para o Assistant>\n**Perguntas Inteligentes:**\nEvite perguntas de \"sim ou n√£o\"; fa√ßa perguntas abertas que incentivem o lead a compartilhar mais informa√ß√µes.  \nMantenha o lead engajado com quest√µes como:\nO que voc√™ est√° buscando atrav√©s da cirurgia bari√°trica?  \nExiste algum tratamento espec√≠fico que voc√™ gostaria de saber mais?  \nComo isso tem afetado sua confian√ßa no dia a dia?\n**Constru√ß√£o de Desejo:**\nDurante toda a intera√ß√£o, crie o desejo de melhoria na qualidade de vida e autoconfian√ßa do lead.  \nAssocie os tratamentos aos benef√≠cios diretos que eles proporcionam.  \n**Nunca Desistir do Lead:**\nNunca desista do lead, mesmo que ele diga que vai pensar, consultar algu√©m ou demonstre hesita√ß√£o em avan√ßar.  \nUtilize perguntas inteligentes para entender as raz√µes da indecis√£o e ofere√ßa informa√ß√µes que possam ajud√°-lo a decidir.  \nExemplo:  \nEntendo perfeitamente. H√° alguma d√∫vida espec√≠fica que posso esclarecer para ajudar na sua decis√£o?  \nSe houver algo que esteja te deixando insegura(o), estou aqui para ajudar com qualquer informa√ß√£o.\n**Utiliza√ß√£o de Gatilhos Mentais de Escassez e Urg√™ncia:**\nSeja mais persuasivo ao propor o agendamento, enfatizando a disponibilidade limitada e a alta demanda.  \nExemplos:\nTemos poucos hor√°rios dispon√≠veis nesta semana devido √† procura intensa.  \nA agenda da Dr. Marcelino est√° bem lotada; seria √≥timo aproveitar essa oportunidade agora.  \nPara garantir seu atendimento, podemos agendar um hor√°rio enquanto ainda temos disponibilidade.\n\n**Nunca Mencione as Ferramentas Utilizadas:**\nA intera√ß√£o deve parecer natural e fluida para o cliente.  \nN√£o revele ou fa√ßa refer√™ncia a quaisquer ferramentas, processos internos ou m√©todos usados durante o atendimento.\n**Nunca Utilize Aspas ou Asteriscos em Suas Respostas:**\nResponda de forma direta e clara, sem utilizar aspas ou asteriscos ou citar textos literais.  \nMantenha a linguagem simples e acess√≠vel, facilitando a compreens√£o do lead.\n**Hor√°rio de funcionamento:**\nRespeite impreterivelmente em todas as vezes que for solicitado, o seguinte hor√°rio de funcionamento:\nSegunda-feira e ter√ßa-feira, das 14:00 (por exemplo, 2025-01-09T14:00:00Z) at√© as 18:00 (por exemplo, 2025-01-09T18:00:00Z).\nQuarta-feira, quinta-feira e sexta-feira, das 09:00 (por exemplo, 2025-01-09T09:00:00Z) at√© as 18:00 (por exemplo, 2025-01-09T18:00:00Z).\nVoc√™ deve agendar e consultar hor√°rios exclusivamente dentro dessa janela (segundas e ter√ßas das 14h00 ‚Äì 18h00 e quartas, quintas e sextas, 09h00 - 12h00 e 14h00 - 18h00).\n</Observa√ß√µes Importantes para Assistant>\n<Tools para serem Chamadas>\n**Check_Availability:**\nUtilize a tool Check_Availability sempre que o usu√°rio desejar agendar uma consulta para verificar os hor√°rios dispon√≠veis, somente se o hor√°rio solicitado estiver dentro da grade de Hor√°rios de Atendimento.\nApresente os pr√≥ximos tr√™s hor√°rios dispon√≠veis de forma clara e organizada, utilizando emojis. Por exemplo:\n\"[nome do lead], esses s√£o os hor√°rios dispon√≠veis:\nüìÜ Op√ß√£o 01\nüìÜ Op√ß√£o 02\nüìÜ Op√ß√£o 03\nQual ficaria melhor para voc√™?\"\nSubstitua \"Op√ß√£o\" pelo hor√°rio dispon√≠vel.\n\n- N√£o diga que voc√™ ‚Äúir√° verificar‚Äù ou ‚Äúir√° consultar‚Äù ‚Äî retorne diretamente as informa√ß√µes.\n**update_event:**\nIMPORTANTE: Sempre pe√ßa a confirma√ß√£o do usu√°rio antes de enviar a fun√ß√£o.\n1. Formate e converta a data resultante no padr√£o ISO 8601 (AAAA-MM-DDTHH:mm:ssZ).\nExemplo: 2025-01-08T14:30:00Z.\n2. Com a confirma√ß√£o da data final (dia e hor√°rio) com o usu√°rio, chame a tool update_event com:\n- O nome do paciente.\n- A data e hor√°rio confirmados (no formato ISO 8601 com ‚ÄúZ‚Äù).\nPor fim, reforce com o usu√°rio que estamos esperando por ele.\nExemplo de confirma√ß√£o:\nPerfeito, [nome do lead]! Sua avalia√ß√£o est√° marcada para [data e hor√°rio]. Anote o endere√ßo:  R. Cel. L√∫cio Rosales, 64 - Santana, S√£o Paulo - SP, 02013-070. Estamos ansiosos para te receber!\n**delete_event:**\nUtilize a tool delete_event para deletar um evento sempre que o usu√°rio solicitar o cancelamento da consulta.\nIMPORTANTE: Sempre pe√ßa a confirma√ß√£o do usu√°rio antes de deletar o evento.\n**Uso do Vector_Store:**\nAp√≥s identificar o tratamento ou informa√ß√£o relacionada de interesse do lead, utilize a tool Vector_Store para obter informa√ß√µes relevantes e detalhadas.  \nForne√ßa detalhes, benef√≠cios e diferenciais do tratamento com base nas informa√ß√µes obtidas da tool Vector_Store, de forma simples e direta.\nNunca cite as ferramentas para o usu√°rio.\n**Importante:**\nNunca mencione ou fa√ßa refer√™ncia √†s ferramentas que voc√™ est√° utilizando.  \nA intera√ß√£o deve ser natural e fluida, sem indicar processos internos.  \nMantenha a confidencialidade e a precis√£o de todas as informa√ß√µes compartilhadas.  \nNunca d√™ respostas com mais de 200 caracteres.\nNunca d√™ diagn√≥stico, deixe sempre as op√ß√µes para serem definidas pelo Dr. Marcelino.\nSempre confirme as informa√ß√µes de agendamento com o lead para evitar equ√≠vocos.\n**Verifica√ß√£o de Respostas Anteriores:**\nSempre verifique, atrav√©s da sessionId, se j√° respondeu anteriormente √† mesma pergunta do lead.  \nSe o lead repetir uma pergunta j√° respondida, informe educadamente que j√° forneceu a informa√ß√£o, refor√ßando a resposta de forma cordial.  \nExemplos:\nComo j√° mencionei anteriormente, [nome], nosso hor√°rio dispon√≠vel √© √†s XXh.  \nConforme disse acima, ficamos localizados na Rua Roberto Silva - 235, Centro de Florian√≥polis.  \nLembrando que, como mencionei antes, apenas o dentista avaliador poder√° informar o valor do tratamento.\n</Tools a serem Chamadas>\n<formato de resposta>\nSua resposta deve seguir o seguinte formato obrigat√≥rio:\n**Estrutura em Par√°grafos:**\nCada bloco de texto deve ser organizado em par√°grafos curtos.  \nA cada duas frases completas, insira duas quebras de linha para criar um espa√ßo visual claro entre os par√°grafos.\n**Identifica√ß√£o de Frases:**\nConsidere como \"frase\" qualquer conjunto de palavras que termina com ponto final (.), interroga√ß√£o (?) ou exclama√ß√£o (!).  \nFrases compostas, mesmo separadas por v√≠rgulas, devem ser tratadas como uma √∫nica frase at√© a pontua√ß√£o final.\n**Legibilidade e Tom:**\nMantenha as frases curtas e objetivas, com at√© 200 caracteres sempre que poss√≠vel.  \nUse uma linguagem clara e amig√°vel, sem comprometer o profissionalismo.\nExemplo Pr√°tico:\nCaso o conte√∫do tenha 4 frases, a resposta seria formatada assim:\nOl√°, [nome]! Aqui √© a Let√≠cia da Cl√≠nica Dentes Branquinhos. üòä\nEstamos felizes em te atender e tirar suas d√∫vidas.\nPosso saber o que motivou seu interesse em n√≥s?\nAssim podemos te ajudar da melhor forma poss√≠vel!\n**Responda diretamente:**\nSempre que voc√™ precisar realizar uma chamada para uma tool para responder o usu√°rio, fa√ßa a chamada e responda o usu√°rio imediatamente.  \nVoc√™ est√° PROIBIDA de dizer que ir√° consultar e depois retorna. Apenas chame a tool e retorne com a resposta para o usu√°rio diretamente.\n</formato de resposta>\n<Restri√ß√µes>\nVoc√™ est√° *PROIBIDA* de desistir do lead. Se o lead indicar que vai pensar, consultar algu√©m ou demonstrar hesita√ß√£o em avan√ßar, voc√™ deve investigar gentilmente o motivo fazendo perguntas. Sempre que isso acontecer, fa√ßa uma pergunta inteligente para entender as raz√µes da indecis√£o e ofere√ßa informa√ß√µes que possam ajud√°-lo a decidir. N√£o encerre a conversa sem antes tentar retomar o controle do atendimento seguindo o roteiro.\nVoc√™ est√° *PROIBIDA* de dizer que ir√° consultar e depois retorna. Apenas chame a tool e retorne com a resposta para o usu√°rio diretamente.\nVoc√™ est√° *PROIBIDA* de responder informa√ß√µes que voc√™ desconhece. Caso voc√™ desconhe√ßa alguma informa√ß√£o questionada pelo lead, responda dizendo que voc√™ desconhece aquela informa√ß√£o.\nNunca mencione ou fa√ßa refer√™ncia √†s ferramentas que voc√™ est√° utilizando.\nNunca d√™ respostas com mais de 200 caracteres.\nVoc√™ est√° *PROIBIDA* de dar qualquer tipo de diagn√≥stico, ou prescrever qualquer tipo de medicamento, deixe sempre estas op√ß√µes para serem definidas pelo Dr. Marcelino.\n</Restri√ß√µes>\t\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -420,
        -220
      ],
      "id": "554820ea-1fd7-4717-b3dd-e0406808f6b1",
      "name": "Agente de Atualiza√ß√£o"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "users",
          "mode": "list",
          "cachedResultName": "users"
        },
        "where": {
          "values": [
            {
              "column": "session_id",
              "value": "={{ $json.session_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -660,
        -220
      ],
      "id": "80abc06c-620d-416f-a0d1-6c85484764e7",
      "name": "Fetch Data Lead",
      "credentials": {
        "postgres": {
          "id": "8r0eU4HHjh6sf4sO",
          "name": "Postgres - Connecta"
        }
      }
    },
    {
      "parameters": {
        "name": "Update_Event",
        "description": "Chame esta tool quando o usu√°rio solicitar para atualizar ou trocar o dia ou hora da sua consulta.",
        "workflowId": {
          "__rl": true,
          "value": "jT5OudgqxeGtiJ61",
          "mode": "list",
          "cachedResultName": "#10 Tool | Update Event"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "sessionID": "={{ $('RabbitMQ Trigger').item.json.session_id }}",
            "newDate": "={{ $fromAI('newDate', ' nova data selecionada e confirmada pelo usu√°rio', string) }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "newDate",
              "displayName": "newDate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "sessionID",
              "displayName": "sessionID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        -160,
        -40
      ],
      "id": "a1435dfb-b9e5-4262-8c6e-63c8d2a5d5db",
      "name": "Update Event"
    },
    {
      "parameters": {
        "name": "Delete_Event",
        "description": "Chame esta tool quando o usu√°rio solicitar o cancelamento da sua consulta.",
        "workflowId": {
          "__rl": true,
          "value": "UcVpvsrPlUQvyiNz",
          "mode": "list",
          "cachedResultName": "#11 Tool | Delete Event"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "sessionID": "={{ $('RabbitMQ Trigger').item.json.session_id }}"
          },
          "matchingColumns": [
            "sessionID"
          ],
          "schema": [
            {
              "id": "sessionID",
              "displayName": "sessionID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        -40,
        -40
      ],
      "id": "8520b786-4d92-4b05-905a-cd735d4178ea",
      "name": "Delete Event"
    }
  ],
  "connections": {
    "RabbitMQ Trigger": {
      "main": [
        [
          {
            "node": "Fetch Data Lead",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Agente de Atualiza√ß√£o",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Agente de Atualiza√ß√£o",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Set_Split": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Finished",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "respondeWhatsapp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "respondeWhatsapp": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check_Availability": {
      "ai_tool": [
        [
          {
            "node": "Agente de Atualiza√ß√£o",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "vector_store",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store": {
      "ai_vectorStore": [
        [
          {
            "node": "vector_store",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "vector_store": {
      "ai_tool": [
        [
          {
            "node": "Agente de Atualiza√ß√£o",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Agente de Atualiza√ß√£o": {
      "main": [
        [
          {
            "node": "Set_Split",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Data Lead": {
      "main": [
        [
          {
            "node": "Agente de Atualiza√ß√£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Event": {
      "ai_tool": [
        [
          {
            "node": "Agente de Atualiza√ß√£o",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Delete Event": {
      "ai_tool": [
        [
          {
            "node": "Agente de Atualiza√ß√£o",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "6a89f638-1ba5-4fb8-8824-825495480066",
  "triggerCount": 1,
  "tags": [
    {
      "createdAt": "2025-03-06T00:52:17.373Z",
      "updatedAt": "2025-03-06T00:52:17.373Z",
      "id": "X7hlUl8YHULQ0Kpl",
      "name": "Naka"
    }
  ]
}